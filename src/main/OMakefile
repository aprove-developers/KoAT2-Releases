OCAMLPACKS[] =
    batteries
    apron
    apron.octD
    apron.boxD
    ppx_deriving_cmdliner
    ppx_deriving.show
    ppx_getenv
    z3
    ocamlgraph
    fpath

OCAMLINCLUDES[] =
    ../util
    ../poly
    ../constraints
    ../smt
    ../transitionsystem
    ../parser
    ../bounds
    ../preprocessors

OCAML_LIBS[] =
    ../util/util
    ../poly/poly
    ../constraints/constraints
    ../smt/smt
    ../transitionsystem/transitionsystem
    ../parser/parser
    ../bounds/bounds
    ../preprocessors/preprocessors

# Include all .ml files
FILES[] = $(removesuffix .ml, $(glob *.ml))

LIB = main

# For koat2 --version
if $(not $(defined-env KOAT2_GIT_VERSION))
    VERSION = $(shell (git rev-parse --short HEAD))
    DATE = $(shell (git log -1 --format=%cs))
    VERSIONSTR = $(VERSION) from $(DATE)
    setenv(KOAT2_GIT_VERSION, $(VERSIONSTR))
    export

OCamlProgram(koat2, $(FILES))

install: koat2


InterfaceDoc($(LIB), $(FILES))

clean:
  rm -f \
     *.omc \
     *.idoc \
     *.cmo \
     $(filter-proper-targets $(glob $(addsuffix .*, $(FILES)))) \
     $(LIB).a $(LIB).cmxa $(LIB).cma \
     koat2 koat2.opt \
