\subsection{Ranking functions}

This section introduces a definition of ranking functions.
Ranking functions are well studied (\cite{bradley2005polyranking}, \cite{podelski2004prf}, \cite{bradley2005linear}, \cite{bagnara2012new}, \cite{leike2014ranking}, \cite{ben2013linear}) and widely used in termination and complexity analysis.

The new method uses ranking functions for two different purposes:
For the computation of time bounds and for the computation of cost bounds.
For the computation of time bounds, we use a definition of the KoAT paper \cite{koat}.

\begin{definition}[Time Ranking Function] 
  We define $\timerank: \LSet \rightarrow \BoundSet_p(\PVSet)$ as time ranking function for a transition set $\TSet$ if and only if there is a nonempty set of strictly decreasing transitions $\TSet_{>} \subseteq \TSet$ such that the following statements hold.
  For all transitions $t = (\location, \update, \guard, \location') \in \TSet$ and every evaluation step $(\location, \valuation) \rightarrow_t (\location', \valuation')$ it holds that
  \[ \exacteval{\guard}{\valuation} \Rightarrow \exacteval{\timerank(\location)}{\valuation} \geq \exacteval{\timerank(\location')}{\valuation'}. \]
  For all transitions $(\location, \update, \guard, \location') \in \TSet_{>}$ and every evaluation step $(\location, \valuation) \rightarrow_t (\location', \valuation')$ it holds that        
  \[ \exacteval{\guard}{\valuation} \Rightarrow \exacteval{\timerank(\location)}{\valuation} - 1 \geq \exacteval{\timerank(\location')}{\valuation'} \]
  and
  \[ \exacteval{\guard}{\valuation} \Rightarrow \exacteval{\timerank(\location)}{\valuation} \geq 1. \]
\end{definition}

A time ranking function $\timerank$ implies that a transition $t \in \TSet_>$ can only be used a limited number of times in an evaluation.
This is ensured, since a transition $t \in \TSet_>$ both decreases the measure and is bounded by $1$, as well as other transitions $t \in \TSet$ do not increase the measure.
Therefore, for the transitions $t \in \TSet_>$ the rank $\timerank(\location)$ at a location $\location \in \LSet$ can be used as a bound on the number of occurrences of this transition in any evaluation from this location on.

\begin{example}[Time ranking function]
  Consider the program from the introduction in Figure \ref{fig:motivational_example}
  \input{graphs/motivational_example}
  As already pointed out, the polynomial $x-y$ is a time rank for the location $\location_1$.
  This fact can be formalized in the following way.
  Consider the function $\timerank: \LSet \rightarrow \BoundSet_p(\PVSet)$ with $\timerank(\location_1) = x-y$.
  This function is a time ranking function for the transition set $\TSet = \braced{t_1}$, if $\TSet_> = \braced{t_1}$.
  For the single transition $t_1$ it holds for every evaluation step $(\location_1,\valuation) \rightarrow_{t_1} (\location_1,\valuation')$ that $\exacteval{x>y}{\valuation} \Rightarrow \exacteval{x-y}{\valuation} > \exacteval{x-y}{\valuation'}$, since $x$ decreases such an evaluation step.
  Also, it holds for every evaluation step $(\location_1,\valuation) \rightarrow_{t_1} (\location_1,\valuation')$ that $\exacteval{x>y}{\valuation} \Rightarrow \exacteval{x-y}{\valuation} \geq 1$.
  Note that in this example it would also be possible to consider the transition $t_0$ as part of the set $\TSet$, since it holds for every evaluation step $(\location_1,\valuation) \rightarrow_{t_0} (\location_1,\valuation')$ that $\valuation(x)=\valuation'(x)$ and $\valuation(y)=\valuation'(y)$ and therefore $\exacteval{\textbf{true}}{\valuation} \Rightarrow \exacteval{x-y}{\valuation} \geq \exacteval{x-y}{\valuation'}$.
\end{example}

We can use the same approach for the direct inference of cost bounds.

\begin{definition}[Cost Ranking Function] 
  We define $\costrank: \LSet \rightarrow \BoundSet_p(\PVSet)$ as cost ranking function for a transition set $\TSet$ if and only if there is a nonempty set of strictly decreasing transitions $\TSet_{>} \subseteq \TSet$ such that the following statements hold.
  For all transitions $t = (\location, \update, \guard, \location') \in \TSet$ and every evaluation step $(\location, \valuation) \rightarrow_t (\location', \valuation')$ it holds that
  \[ \exacteval{\guard}{\valuation} \Rightarrow \exacteval{\costrank(\location)}{\valuation} \geq \exacteval{\costrank(\location')}{\valuation'}. \]
  For all transitions $(\location, \update, \guard, \location') \in \TSet_{>}$ and every evaluation step $(\location, \valuation) \rightarrow_t (\location', \valuation')$ it holds that        
  \[ \exacteval{\guard}{\valuation} \Rightarrow \exacteval{\costrank(\location)}{\valuation} - \exacteval{\cost(t)}{\valuation} \geq \exacteval{\costrank(\location')}{\valuation'} \]
  and
  \[ \exacteval{\guard}{\valuation} \Rightarrow \exacteval{\costrank(\location)}{\valuation} \geq \exacteval{\cost(t)}{\valuation} \]
\end{definition}

Since this definition ensures, that each transition $t \in \TSet_>$ decreases in each transition step by its cost, the cost rank $\costrank(\location)$ can be used as a bound on the sum of all occurred costs of the transition $t$ from this location on.

\begin{example}[Cost ranking function]
  Consider the program in Figure \ref{fig:cost_ranking_function}.
  \input{graphs/cost_ranking_function}
  We can show that the function $\costrank$ with $\costrank(\location_1) = x$ is a cost ranking function for the transition set $\TSet = \braced{t_1}$.
  For every evaluation step $(\location_1,\valuation) \rightarrow_{t_1} (\location_1,\valuation')$ it holds that $\exacteval{\braced{y > 0, x > y}}{\valuation} \Rightarrow \exacteval{x}{\valuation} - \exacteval{y}{\valuation} > \exacteval{x}{\valuation'}$, since the value of $x$ decreases in every evaluation step with the value of $y$.
  Also, it holds for every evaluation step $(\location_1,\valuation) \rightarrow_{t_1} (\location_1,\valuation')$ that $\exacteval{\braced{y > 0, x > y}}{\valuation} \Rightarrow \exacteval{x}{\valuation} \geq \exacteval{y}{\valuation}$, since the value of $x$ is greater than $y$ in every evaluation step.
\end{example}

The example shows the potentials of the usage of cost ranking functions.
The best time ranking function determinable is a function $\timerank$ with $\timerank = \costrank$.
Therefore, only a time bound of $x$ can be computed for the transition $t_1$.
As a consequence, a resulting cost bound of the transition $t_1$ would be $x*y$, which is significantly worse than a cost bound of $x$ resulting from an approach with a cost ranking function.
Later in this thesis this cost ranking approach is discussed in detail.

For the computation of ranking functions, it is common to use an SMT-Solver.
An SMT-Solver is capable of proving satisfiability and unsatisfiability of existential formulas.
The presented definition of time ranking functions and cost ranking functions consists of conditions, which need to be fulfilled for all states $\valuation, \valuation' \in \Valuation$ of all evaluation steps $(\location, \valuation) \rightarrow_t (\location', \valuation')$.
Such a universal quantified formula can be proven by showing the unsatisfiability of the negation of the formula with an SMT-Solver.
But for ranking functions it is also necessary to consider, that the coefficients of a timerank polynomial $\timerank(\location)$ are existentially quantified in the conditions of the ranking function definition.
Therefore, a negation of the condition yields universal quantification of the coefficients of a timerank.
Thus, the negation of the condition is also not provable by an SMT-Solver.

For such formulas, which contain both existential and universal quantification, it is common to use a variant of Farkas' lemma \cite{schrijver1998theory} specialized for polyranking \cite{bradley2005polyranking}.
For this purpose, it is necessary to restrict the domain of timeranks $\timerank(\location)$ and costranks $\costrank(\location)$ to affine polynomials $\BoundSet_a(\PVSet)$.
Then, it is possible to transform the problem of finding a ranking function into a problem solvable with an SMT-Solver.
