\section{Result Variable Graph}

For the analysis of size bounds, it is helpful to consider a graph which contains information about which result variables affect each other.
Such a graph is presented as a result variable graph in \cite{koat}.
Before we can define the actual result variable graph, we need to define the terms of pre-transitions and active variables.
The pre-transitions of a transition $t \in \TSet$ are all transitions, which may occur immediately before an evaluation step with the transition $t$.

\begin{definition}[Pre-Transitions] 
  We define $\pre: \TSet \rightarrow 2^\TSet$ as
  \[\pre(t) = \braced{\pret \in \TSet \mid \exists \valuation_0, \location, \valuation: (\location_0, \valuation_0) (\rightarrow^* \circ \rightarrow_\pret \circ \rightarrow_{t}) (\location, \valuation)}\]
  to denote the set of all transitions that may precede the transition $t$ in an evaluation.	
\end{definition}

\begin{example}[Pre-Transitions] 
  \input{graphs/rvg_example_program}
  Consider the program in Figure \ref{fig:rvg_example_program}.
  The set of pre-transitions for $t_0$ is empty, since no transition can occur before an initial transition $t_0 \in \TSet_0$.
  The set of pre-transitions for $t_1$ is $\pre(t_1) = \braced{t_0, t_1}$, since both $t_0$ and $t_1$ may occur directly before the occurrence of the transition $t_1$.
  Also, the set of pre-transitions for $t_2$ is $\pre(t_2) = \braced{t_0, t_1}$.
\end{example}

The function $\pre_{\mathit{trivial}}((\location_1, \update_1, \guard_1, \location_1')) = \braced{(\location_2, \update_2, \guard_2, \location_2') \in \TSet \mid \location_2' = \location_1}$ is a valid over approximation of $\pre(t)$.
Additionally to pre-transitions, we define the active variables of bounds. 

\begin{definition}[Active Variables]
  Let $\VSet$ be a finite set of variables.  
  A variable $v \in \VSet$ is active in a bound $b \in \BoundSet(\VSet)$ if and only if there are two states $\valuation, \valuation' \in \Valuation$ with $\valuation(v') = \valuation'(v')$ for each $v' \in \VSet \setminus \braced{v}$ and $\valuation(v) \neq \valuation'(v)$ such that $\exacteval{b}{\valuation} \neq \exacteval{b}{\valuation'}$.
  Then, the function $\actV: \BoundSet(\VSet) \rightarrow 2^\VSet$ describes by $\actV(b)$ all variables, which are active in the bound $b \in \BoundSet(\VSet)$.
\end{definition}

\begin{example}[Active Variables] 
  Again, consider the program in Figure \ref{fig:rvg_example_program}.
  The $y$-update $\update(y)$ of the transition $t_1$ has the active variables $\actV(\update(y)) = \braced{x,y,z}$.
  The $x$-update $\update(x)$ of the transition $t_2$ does not have active variables, i.e. $\actV(\update(x)) = \emptyset$.
\end{example}

A valid overapproximation of the active variables of a bound $b \in \BoundSet(\VSet)$ is the set of all occurring variables.
\begin{definition}[Overapproximation of Active Variables]
  For a bound $b \in \BoundSet(\VSet)$, we define an overapproximation of the active variables $\actV(b)$.
  \[ \actV(\infty) = \emptyset \text{ for } \infty \in \BoundSet(\VSet) \]
  \[ \actV(k) = \emptyset \text{ for all } k \in \mathbb{N} \subseteq \BoundSet(\VSet) \] 
  \[ \actV(v) = \braced{v} \text{ for all } v \in \VSet \subseteq \BoundSet(\VSet) \] 
  \[ \actV(-b) = \actV(b) \text{ for all } b \in \BoundSet(\VSet) \] 
  \[ \actV(b_1 + b_2) = \actV(b_1) \cup \actV(b_2) \text{ for all } b_1, b_2 \in \BoundSet(\VSet) \] 
  \[ \actV(b_1 \cdot b_2) = \actV(b_1) \cup \actV(b_2) \text{ for all } b_1, b_2 \in \BoundSet(\VSet) \] 
  \[ \actV(\max(b_1, b_2)) = \actV(b_1) \cup \actV(b_2) \text{ for all } b_1, b_2 \in \BoundSet(\VSet) \]
  \[ \actV(k^b) = \actV(b) \text{ for all } k \in \mathbb{N} \subseteq \BoundSet(\VSet), b \in \BoundSet(\VSet) \]  
\end{definition}

Note that this overapproximation recognizes the variable $x$ as active in a bound $x - x$.
For our purposes this is sufficient, but in some cases, the implementation is also able to detect such properties due to the simplification of bounds.
The implementation simplifies a bound $x - x$ to a bound $0$ and as a consequence, the variable $x$ is not considered as active.

Additionally to these definitions, the definition of a result variable graph is based on local size bounds.
A local size bound $\LSB$ approximates the value of a program variable $v \in \PVSet$ after a single evaluation step.
While the lower local size bound $\LLSB(t,v)$ yields an underapproximation of the actual value of $v$ after an evaluation step with the transition $t$, the upper local size bound $\ULSB$ yields an overapproximation.
Local size bounds are discussed later in this thesis in detail.

With these definitions, it is possible to define the result variable graph.

\begin{definition}[Result Variable Graph]
  Let $\Program = ((\LSet, \TSet), \location_0, \PVSet, \TVSet, \cost)$ be a program.
  Let $\LSB$ be a local size bound.
  We define 
  \[ \text{RVG} = (\TSet \times \PVSet, \braced{((t, v), (t', v')) \mid t \in \pre(t'), v \in \actV(\LLSB(t',v')) \cup \actV(\ULSB(t',v'))}) \]
  to denote a \textbf{result variable graph}.
\end{definition}

Note that since pre-transitions and active variables are both defined as overapproximations, a result variable graph is an overapproximation of the dependencies between result variables as well.

\begin{example}[Result Variable Graph]
  Consider the result variable graph in Figure \ref{fig:rvg_example}.
  This result variable graph corresponds to the program in Figure \ref{fig:rvg_example_program}.
  \input{graphs/rvg_example}
  The program consists of an initial transition $t_0$, a loop $t_1$ and an exit transition $t_2$.
  The value of the variable $x$ is completely unaffected by the other variables of the program and is set to a constant in the exit transition $t_2$.
  While this information is not directly available in the program graph, it is shown in the result variable graph since no edge is leading from a result variable with $y$ or $z$ to a result variable with $x$.
  On the other hand, the variables $y$ and $z$ affect each other in the loop $t_1$.
  This is directly reflected by the fact, that $(t_1,y)$ and $(t_1,z)$ form an SCC in the result variable graph.
  This SCC is highlighted by bold edges.
  The analysis of this thesis, as well as the method of \cite{koat}, use SCC information to determine size bounds.
\end{example}
