\section{Computing Cost Bounds}

The last two chapters introduced algorithms for the computation of time bounds and size bounds.
The algorithm for the computation of time bounds uses the so far computed size bounds and the algorithm for the computation of size bounds uses the so far computed time bounds.
This chapter presents a cost bound algorithm, which runs after the consecutive executions of the time and size bound algorithms and uses the resulting time and size bounds for the computation of cost bounds.

\subsection{Computing Initial Cost Bounds}

A trivial initial approach for the computation of a cost bound $\UCost(t)$ of a transition $t \in \TSet$ is the multiplication of the time bound $\UTime(t)$ with the maximum of the substituted costs $\usubst{\cost(t)}{\LSize(\pret)}{\USize(\pret)}$ for a pre-transition $\pret \in \pre(t)$.
For the computation of a cost bound $\UCost(t)$ of an initial transition $t \in \TSet_0$ the substitution is not necessary, since there are no pre-transitions of an initial transition $t \in \TSet_0$ and the variables of the costs $\cost(t)$ are already expressed in dependence on the input variables of the program.

\begin{definition}[Initial Cost Bound]
  Let $\UCost: \TSet \rightarrow \BoundSet(\PVSet)$ be defined with
  \[ \UCost(t) = \UTime(t) \cdot
  \begin{cases}
    \cost(t) & \text{if } t \in \TSet_0 \\
    \maximum{\usubst{\cost(t)}{\LSize(\pret)}{\USize(\pret)} \mid \pret \in \pre(t)} & \text{otherwise }
  \end{cases}
  \]
  Then, we call $\UCost$ an \textbf{initial cost bound}. 
\end{definition}

Since the cost $\exacteval{\cost(t)}{\valuation}$ of a single evaluation step with $t \in \TSet$ is defined to be positive for every state $\valuation$, it is not necessary to use an operator $\maxO{\cdot}$ on the cost of a transition.

\begin{example}[Initial Cost Bound]
  Consider the program in Figure \ref{fig:cost_ranking_function_costbounds}.
  \input{graphs/cost_ranking_function_costbounds}
  The program takes two variables $x$ and $y$.
  It decreases the value of $x$ in each step with $t_1$ by the value of $y$.
  Each step with $t_1$ has a cost of the current value of $y$.
  Since the value of $y$ never changes, the cost of the transition $t_1$ is constant throughout the execution of the loop.
  The guard ensures that $x > y > 0$.
  Therefore, the method \emph{TimeBounds} can compute a time bound $\UTime(t_1) = \maxO{x}$.
  Since the size of $y$ is bound with $\USize(t_0) = y$ after the transition $t_0$, an initial cost bound $\UCost(t_1) = \UTime(t_1) \cdot \usubst{\cost(t_1)}{\LSize(t_0)}{\USize(t_0)} = \maxO{x} \cdot y$ can be inferred.
\end{example}

\subsection{Computing Cost Bounds with Ranking Functions}

Additionally to initial cost bounds, we use ranking functions, to infer better cost bounds for single transitions.
With some changes, the definition of time ranking functions is transferable to the context of costs.

\begin{definition}[Cost Ranking Function] 
  We define $\costrank: \LSet \rightarrow \BoundSet_p(\PVSet)$ as \textbf{cost ranking function} for a transition set $\TSet$ if and only if there is a nonempty set of strictly decreasing transitions $\emptyset \neq \TSet_{>} \subseteq \TSet$ such that the following statements hold.
  For every evaluation step $(\location, \valuation) \rightarrow_t (\location', \valuation')$ with a transition $t \in \TSet$ it holds that
  \[ \exacteval{\costrank(\location)}{\valuation} \geq \exacteval{\costrank(\location')}{\valuation'}. \]
  For every evaluation step $(\location, \valuation) \rightarrow_t (\location', \valuation')$ with a transition $t \in \TSet$ it holds that        
  \[ \exacteval{\costrank(\location)}{\valuation} - \exacteval{\cost(t)}{\valuation} \geq \exacteval{\costrank(\location')}{\valuation'} \]
  and
  \[ \exacteval{\costrank(\location)}{\valuation} \geq \exacteval{\cost(t)}{\valuation} \]
\end{definition}

This definition ensures that each transition $t \in \TSet_>$ decreases in each transition step by its cost.
Also, for each transition $t \in \TSet_>$ the decrease of the rank is bounded by the costs.
Therefore, the cost rank $\costrank(\location)$ can be used as a bound on the sum of all occurred costs of the transition $t$ from this location on.

\begin{example}[Cost Ranking Function]
  Consider again the program in Figure \ref{fig:cost_ranking_function_costbounds}.
  We can show that the function $\costrank$ with $\costrank(\location_1) = x$ is a cost ranking function for the transition set $\TSet = \braced{t_1}$.
  For every evaluation step $(\location_1,\valuation) \rightarrow_{t_1} (\location_1,\valuation')$ it holds that $\exacteval{x}{\valuation} - \exacteval{y}{\valuation} > \exacteval{x}{\valuation'}$, since the value of $x$ decreases in every evaluation step with the value of $y$.
  Therefore, also $\exacteval{x}{\valuation} - \exacteval{y}{\valuation} \geq \exacteval{x}{\valuation'}$ holds.
  Also, it holds for every evaluation step $(\location_1,\valuation) \rightarrow_{t_1} (\location_1,\valuation')$ that $\exacteval{x}{\valuation} \geq \exacteval{y}{\valuation}$, since the value of $x$ is greater than $y$ in every evaluation step.
\end{example}

With a few changes, the \emph{TimeBounds} algorithm is extendable to the computation of cost bounds.

\input{theorems/costbound}

With this definition, it is possible to start with an initial cost bound, search for cost ranking functions and consecutively refine the cost bounds of single transitions, where a cost ranking function is found.

\begin{example}[Cost Bounds]
  Consider again the program in Figure \ref{fig:cost_ranking_function_costbounds}.
  We showed that an initial cost bound can be computed with $\UCost(t_1) = \maxO{x} \cdot y$ and that a cost ranking function $\costrank$ with $\costrank(\location_1) = x$ can be determined.
  The resulting cost bound of the \emph{CostBounds} method is $\UCost(t_1) = \UTime(t_0) \cdot \maxO{\usubst{\costrank(\location_1)}{\LSize(t_0)}{\USize(t_0)}} = 1 \cdot \maxO{x}$.
  This is significantly better than the initial cost bound of $\UCost(t_1) = \maxO{x} \cdot y$.
\end{example}

