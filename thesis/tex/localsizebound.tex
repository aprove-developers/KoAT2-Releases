This section presents an algorithm for the computation of local size bounds.
In a first step, we define the possible local size bounds as a subset of all bounds $\BoundSet(\PVSet)$.
This way we are able to use specific characteristics of local size bounds later in the definition of the method for global size bounds.
We define two subsets $\BoundSet^\sqcup_l, \BoundSet^\sqcap_l \subseteq \BoundSet(\PVSet)$, one for lower local size bounds and one for upper local size bounds.

\begin{definition}[Local bound sets]
  Let $B$ denote the set of tuples $(s,e,P_1,P_2,N_1,N_2) \in \mathbb{N} \times \mathbb{Z} \times 2^\PVSet \times 2^\PVSet \times 2^\PVSet \times 2^\PVSet$ with $s \geq 1$, $P_1 \cap P_2 = \emptyset$ and $N_1 \cap N_2 = \emptyset$.
  Then, we define $\BoundSet^\sqcup_l \in \BoundSet(\PVSet)$ as 
  \[ \BoundSet^\sqcup_l = \left\{
    s \cdot \left(
        e
      + \sum_{v \in P_1} v
      - \sum_{v \in N_1} v
      - \sum_{v \in P_2} \maxO{-v}
      - \sum_{v \in N_2} \maxO{v}
      \right) \mid (s,e,P_1,P_2,N_1,N_2) \in B \right\} \]
  Also, we define $\BoundSet^\sqcap_l \in \BoundSet(\PVSet)$ as 
  \[ \BoundSet^\sqcap_l = \left\{
    s \cdot \left(
        e
      + \sum_{v \in P_1} v
      - \sum_{v \in N_1} v
      + \sum_{v \in P_2} \maxO{v}
      + \sum_{v \in N_2} \maxO{-v}
      \right) \mid (s,e,P_1,P_2,N_1,N_2) \in B \right\} \]
\end{definition}

Remember, that a local size bound $\LSB$ is an approximation of the values of variables after a single evaluation step with a transition $t$.
A pair $(t,v)$ of a transition and a variable is also writable as a result variable $\rv = (t,v)$.
We now use the defined local bound sets for the definition of a concrete local size bound, which we call a scaled sum.

\begin{definition}[Scaled sum]
  We say that $\rv \in \RV$ is bounded by an \textbf{upper scaled sum} if and only if there is an upper local size bound $\ULSB(\rv) \in \BoundSet^\sqcap_l$.
  We then denote with $s^\sqcap_\rv$ the scaling factor $s$, with $e^\sqcap_\rv$ the constant $e$ and with the sets $P_{\rv,1}^\sqcap, P_{\rv,2}^\sqcap, N_{\rv,1}^\sqcap, N_{\rv,2}^\sqcap$ the four variable sets $P_1$, $P_2$, $N_1$ and $N_2$.
  We say that $\rv \in \RV$ is bounded by a \textbf{lower scaled sum} if and only if there is a lower local size bound $\LLSB(\rv) \in \BoundSet^\sqcup_l$.
  We then denote with $s^\sqcup_\rv$ the scaling factor $s$, with $e^\sqcup_\rv$ the constant $e$ and with the sets $P_{\rv,1}^\sqcup, P_{\rv,2}^\sqcup, N_{\rv,1}^\sqcup, N_{\rv,2}^\sqcup$ the four variable sets $P_1$, $P_2$, $N_1$ and $N_2$.
\end{definition}

To clarify the possible local size bounds we introduce some examples.

\begin{example}[Upper scaled sum]
  \input{graphs/scaled_sum}
  Consider the five transitions in Figure \ref{fig:scaled_sum}.
  For the transition $t_1$ the update is $\update(x) = x$.
  We can represent an upper scaled sum for $x$ in $t_1$ with $\ULSB(t_1,x) = 1 \cdot (0 + x) = x \in \BoundSet^\sqcap_l$, where $x$ is in $P_1$.
  For the transition $t_2$ the update is $\update(x) = -x$.
  We can represent an upper scaled sum for $x$ in $t_2$ with $\ULSB(t_2,x) = 1 \cdot (0 - x) = -x \in \BoundSet^\sqcap_l$, where $x$ is in $N_1$.
  If $N_1$ was not part of the local bound set $\BoundSet^\sqcap_l$, this would be impossible.
  For the transition $t_3$ the update is $\update(x) = 2 \cdot x + 2 \cdot y + 4$.
  We can represent an upper scaled sum for $x$ in $t_3$ with $\ULSB(t_3,x) = 2 \cdot (2 + x + y) \in \BoundSet^\sqcap_l$, where $x$ and $y$ are in $P_1$.
  
  In the previous three examples, it was sufficient to have $P_2 = \emptyset$ and $N_2 = \emptyset$.
  For the transition $t_4$ the update is $\update(x) = 2 \cdot x + 3 \cdot y$.
  One could suggest the upper scaled sum $b = 3 \cdot (x + y)$.
  But for a state $\valuation$ with $\exacteval{x}{\valuation} < 0$ and $\exacteval{y}{\valuation} > 0$ this bound is not sound, since with $\exacteval{b}{\valuation}$ we would underapproximate the actual value $\exacteval{2 \cdot x + 3 \cdot y}{\valuation}$.
  For these cases, scaled sums provide the sets $P_2$ and $N_2$.
  We can represent an upper scaled sum for $x$ in $t_4$ with $\ULSB(t_4,x) = 3 \cdot (\maxO{x} + y) \in \BoundSet^\sqcap_l$, where $x$ is in $P_2$ and $y$ is in $P_1$.
  This way the upper scaled sum is also sound for negative values of $x$.
  
  For the previous case, we used the set $P_2$.
  The set $N_2$ is provided for the negative counterpart.
  For the transition $t_5$ the update is $\update(x) = -2 \cdot x - 3 \cdot y$.
  We can represent an upper scaled sum for $x$ in $t_5$ with $\ULSB(t_5,x) = 3 \cdot (\maxO{-x} - y) \in \BoundSet^\sqcap_l$, where $x$ is in $N_2$ and $y$ is in $N_1$.
  With this construction, we only consider negative values of $x$ and therefore ensure a sound overapproximation.
\end{example}
  
The construction of a lower scaled sum is very similar to the construction of an upper scaled sum.
The components $s$, $e$, $P_1$ and $N_1$ have the same purpose for lower scaled sums and upper scaled sums.

\begin{example}[Lower scaled sum]
  Consider again the transition $t_1$ with an $\update(x) = x$.
  We can represent a lower scaled sum the same way as an upper scaled sum with $\LLSB(t_1,x) = 1 \cdot (0 + x) = x \in \BoundSet^\sqcup_l$.
  The difference is in the role of the sets $P_2$ and $N_2$.
  While $\sum_{v \in P_2} \maxO{v}$ and $\sum_{v \in N_2} \maxO{-v}$ are added in upper scaled sums, their lower counterparts $\sum_{v \in P_2} \maxO{-v}$ and $\sum_{v \in N_2} \maxO{v}$ are subtracted in lower scaled sums.
  Consider again the transition $t_4$ with the $\update(x) = 2 \cdot x + 3 \cdot y$.
  We can represent a lower scaled sum with $\LLSB(t_4,x) = 3 \cdot (0 - \maxO{-x} + y) \in \BoundSet^\sqcup_l$, where $x$ is in $P_2$ and $y$ is in $P_1$.  
  This way the effect of an unscaled variable is always overapproximated in the upper case and always underapproximated in the lower case.
\end{example}
