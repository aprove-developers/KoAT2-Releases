\chapter{Approximated Replacements}

In the preliminaries, a definition for the exact evaluation of bounds from a bound set $\BoundSet(V)$ was given.
With such an exact evaluation, it is possible to evaluate a bound $b \in \BoundSet(\VSet)$ with respect to a state $\valuation \in \Valuation$ to a value $\exacteval{b}{\valuation} \in \ValueSet$.
In general, we would like to be able to evaluate bounds with respect to arbitrary states $\valuation \in \Valuation$ between a lower bound $\lstate \leq \valuation$ and an upper bound $\ustate \geq \valuation$.

Therefore, we introduce approximated evaluations.
In contrast to an exact evaluation, which replaces variables with a single state $\valuation \in \Valuation$, an approximated evaluation considers two input states $\lstate, \ustate \in \Valuation$.
Then, the bound is evaluated in a way that the result is greater than any exact evaluation with a state $\valuation$ with $\lstate \leq \valuation \leq \ustate$.

We define a generalized principle, which is also applicable to substitutions.

\begin{definition}[Approximated Replacement]
  \allowdisplaybreaks
  Let $K$ be an arbitrary set of elements with an addition $+: K \times K \rightarrow K$, a negation $-: K \rightarrow K$, a multiplication $\cdot: K \times K \rightarrow K$ and a max operator $\max: K \times K \rightarrow K$.
  For a bound $b \in \BoundSet(\VSet)$ and two functions $\lsub, \usub: \VSet \rightarrow K$, we denote with $\lsubst{b}{\lsub}{\usub}$ and $\usubst{b}{\lsub}{\usub}$ functions of the type $(\VSet \rightarrow K) \times (\VSet \rightarrow K) \rightarrow K$.
  These functions replace the variables of the bound $b$ with values from the functions $\lsub, \usub$ such that the following equations hold.
  \begin{align*}
    \lsubst{\infty}{\lsub}{\usub} &= \usubst{\infty}{\lsub}{\usub} = \infty \text{ for } \infty \in \BoundSet(\VSet) \\
    \lsubst{k}{\lsub}{\usub} &= \usubst{k}{\lsub}{\usub} = k \text{ for all } k \in \mathbb{N} \subseteq \BoundSet(\VSet) \\
    \lsubst{v}{\lsub}{\usub} &= \lsub(v) \text{ for all } v \in \VSet \subseteq \BoundSet(\VSet) \\
    \usubst{v}{\lsub}{\usub} &= \usub(v) \text{ for all } v \in \VSet \subseteq \BoundSet(\VSet) \\
    \lsubst{-b}{\lsub}{\usub} &= -\usubst{b}{\lsub}{\usub} \text{ for all } b \in \BoundSet(\VSet) \\
    \usubst{-b}{\lsub}{\usub} &= -\lsubst{b}{\lsub}{\usub} \text{ for all } b \in \BoundSet(\VSet) \\
    \lsubst{b_1 + b_2}{\lsub}{\usub} &= \lsubst{b_1}{\lsub}{\usub} + \lsubst{b_2}{\lsub}{\usub} \text{ for all } b_1, b_2 \in \BoundSet(\VSet) \\
    \usubst{b_1 + b_2}{\lsub}{\usub} &= \usubst{b_1}{\lsub}{\usub} + \usubst{b_2}{\lsub}{\usub} \text{ for all } b_1, b_2 \in \BoundSet(\VSet) \\
    \lsubst{b_1 \cdot b_2}{\lsub}{\usub} &= \minimum{
      \usubst{b_1}{\lsub}{\usub} \cdot \usubst{b_2}{\lsub}{\usub},
      \usubst{b_1}{\lsub}{\usub} \cdot \lsubst{b_2}{\lsub}{\usub},
      \lsubst{b_1}{\lsub}{\usub} \cdot \usubst{b_2}{\lsub}{\usub},
      \lsubst{b_1}{\lsub}{\usub} \cdot \lsubst{b_2}{\lsub}{\usub}
    } \\ & \text{ for all } b_1, b_2 \in \BoundSet(\VSet) \\
    \usubst{b_1 \cdot b_2}{\lsub}{\usub} &= \maximum{
      \usubst{b_1}{\lsub}{\usub} \cdot \usubst{b_2}{\lsub}{\usub},
      \usubst{b_1}{\lsub}{\usub} \cdot \lsubst{b_2}{\lsub}{\usub},
      \lsubst{b_1}{\lsub}{\usub} \cdot \usubst{b_2}{\lsub}{\usub},
      \lsubst{b_1}{\lsub}{\usub} \cdot \lsubst{b_2}{\lsub}{\usub}
    } \\ & \text{ for all } b_1, b_2 \in \BoundSet(\VSet) \\
    \lsubst{\max(b_1, b_2)}{\lsub}{\usub} &= \maximum{\lsubst{b_1}{\lsub}{\usub}, \lsubst{b_2}{\lsub}{\usub}} \text{ for all } b_1, b_2 \in \BoundSet(\VSet) \\
    \usubst{\max(b_1, b_2)}{\lsub}{\usub} &= \maximum{\usubst{b_1}{\lsub}{\usub}, \usubst{b_2}{\lsub}{\usub}} \text{ for all } b_1, b_2 \in \BoundSet(\VSet) \\
    \lsubst{k^b}{\lsub}{\usub} &= k^{\lsubst{b}{\lsub}{\usub}} \text{ for all } k \in \mathbb{N} \subseteq \BoundSet(\VSet), b \in \BoundSet(\VSet) \\
    \usubst{k^b}{\lsub}{\usub} &= k^{\usubst{b}{\lsub}{\usub}} \text{ for all } k \in \mathbb{N} \subseteq \BoundSet(\VSet), b \in \BoundSet(\VSet) \\
  \end{align*}
  We call an expression $\lsubst{b}{\lsub}{\usub}$ an \textbf{underapproximated replacement} and $\usubst{b}{\lsub}{\usub}$ an \textbf{overapproximated replacement}.
\end{definition}

The bound set $\BoundSet(\VSet)$ meets the criteria of $K$.
Therefore, two functions $\lsub, \usub: \VSet \rightarrow \BoundSet(\VSet)$ qualify for an approximated replacement.
We call an approximated replacement with such functions an approximated substitution.

Also, two states $\lstate, \ustate: \VSet \rightarrow \mathbb{Z}$ qualify for an approximated replacement, since $\mathbb{Z}$ meets the criteria of $K$.
We call an approximated replacement with two states an approximated evaluation.

We can show that an overapproximated evaluation always overapproximates the actual value and that an underapproximated evaluation always underapproximates the actual value.

\input{theorems/approximated_replacements}

\begin{example}[Approximated Evaluations]
  The definition of approximated replacements uses implicitly the property of component-wise monotonicity of a bound to infer better over- and underapproximations.

  Consider an overapproximated evaluation $\ueval{x}{\lstate}{\ustate}$ with $\lstate \leq \ustate$.
  It is easy to see, that the bound $x$ is monotonically increasing in $x$.
  Therefore, it is sufficient to substitute the variable $x$ with its overapproximation $\ustate$ to gain a valid overapproximation of the value $\exacteval{x}{\valuation}$ for every state $\valuation$ with $\lstate \leq \valuation \leq \ustate$.
  
  Consider an overapproximated evaluation $\ueval{-x}{\lstate}{\ustate}$ with $\lstate \leq \ustate$.
  It is easy to see, that the bound $-x$ is monotonically decreasing in $x$.
  Therefore, it is sufficient to substitute the variable $x$ with its underapproximation $\lstate$ to gain a valid overapproximation of the value $\exacteval{-x}{\valuation}$ for every state $\valuation$ with $\lstate \leq \valuation \leq \ustate$.
  
  Consider an overapproximated evaluation $\ueval{x \cdot y}{\lstate}{\ustate}$ with $\lstate \leq \ustate$.
  The bound $x \cdot y$ is neither monotonically increasing or decreasing in $x$ nor monotonically increasing or decreasing in $y$.
  Therefore, it is necessary to compute all combinations $\usubst{x}{\lstate}{\ustate} \cdot \usubst{y}{\lstate}{\ustate}$, $\usubst{x}{\lstate}{\ustate} \cdot \lsubst{y}{\lstate}{\ustate}$, $\lsubst{x}{\lstate}{\ustate} \cdot \usubst{y}{\lstate}{\ustate}$ and $\lsubst{x}{\lstate}{\ustate} \cdot \lsubst{y}{\lstate}{\ustate}$.
  Then, the result can be determined as the maximum of all these combinations.
\end{example}

The following definition formalizes the monotonicity of variables in bounds.

\begin{definition}[Monotonicity of Bounds in Variables]
  Let $\VSet$ be a finite set of variables.
  Let $b$ be a bound of the bound set $\BoundSet(\VSet)$.
  Let $v \in \VSet$ be a variable.
  We say that two states $\valuation, \valuation' \in \Valuation$ are only different in $v$ if and only if for each variable $v' \in \VSet \setminus \braced{v}$ it holds that $\valuation(v') = \valuation'(v')$ and for the variable $v$ it holds that $\valuation(v) \neq \valuation'(v)$.
  If it furthermore holds that $\valuation(v) > \valuation'(v)$, we call the state $\valuation$ only different and greater in $v$ than the state $\valuation'$.
  We call the bound $b$ monotonically increasing in the variable $v$ if and only if for all states $\valuation$ that are only different and greater in $v$ than a state $\valuation'$ it holds that $\exacteval{b}{\valuation} \geq \exacteval{b}{\valuation'}$.
  We call the bound $b$ monotonically decreasing in the variable $v$ if and only if for all states $\valuation$ that are only different and greater in $v$ than a state $\valuation'$ it holds that $\exacteval{b}{\valuation} \leq \exacteval{b}{\valuation'}$.
\end{definition}

An approximated replacement yields the better approximations the more variables a bound is monotonically increasing or decreasing in.
Note that an affine polynomial $b \in \BoundSet_a(\VSet)$ is monotonically increasing or decreasing in all variables.
Therefore, the approximated replacement in an affine polynomial yields better over- and underapproximations than the approximated replacement in non-affine polynomials in $\BoundSet_p(\VSet) \setminus \BoundSet_a(\VSet)$ or arbitrary bounds in $\BoundSet(\VSet)$.
